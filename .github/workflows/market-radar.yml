name: Market Radar
on:
  schedule:
    - cron: '0 10-20 * * 1-5'   # hourly 10â€“20 UTC weekdays
  workflow_dispatch:  # allow manual runs
jobs:
  radar:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with: {python-version: '3.12'}
      - name: Download previous database
        uses: actions/download-artifact@v4
        with:
          name: market-radar-db
          path: market_radar/
      - run: pip install -r market_radar/requirements.txt
      - run: |
          echo "SLACK_WEBHOOK=${{ secrets.SLACK_WEBHOOK }}" >  market_radar/.env
          echo "NOTION_TOKEN=${{ secrets.NOTION_TOKEN || '' }}"   >> market_radar/.env
          echo "NOTION_DB=${{ secrets.NOTION_DB || '' }}"        >> market_radar/.env
      - run: python market_radar/radar.py
      - name: Upload database for persistence
        uses: actions/upload-artifact@v4
        with:
          name: market-radar-db
          path: market_radar/sent.db
          retention-days: 7 